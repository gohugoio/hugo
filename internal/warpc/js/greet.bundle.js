(()=>{function w(r){let e=[],a=new Uint8Array(1024);for(console.warn=n=>{console.log(n)},console.error=n=>{console.log(n)};;){let o=0;try{o=Javy.IO.readSync(0,a)}catch(c){if(c.message.includes("os error 29"))break;throw new Error("Error reading from stdin")}if(o<0)throw new Error("Error reading from stdin");if(o===0)break;if(e=[...e,...a.subarray(0,o)],!e.includes(10))continue;let t=0;for(let c=0;t<e.length;t++)if(e[t]===10){let g=e.splice(c,t+1),l=new Uint8Array(g),d;try{d=JSON.parse(new TextDecoder().decode(l))}catch(s){throw new Error(`Error parsing JSON '${new TextDecoder().decode(l)}' from stdin: ${s.message}`)}try{r(d)}catch(s){let u=d.header;u.err=s.message,i({header:u})}c=t+1}e=e.slice(t)}}function i(r){let f=new TextEncoder().encode(JSON.stringify(r)+`
`),e=new Uint8Array(f);Javy.IO.writeSync(1,e)}var h=function(r){i({header:r.header,data:{greeting:"Hello "+r.data.name+"!"}})};console.log("Greet module loaded");w(h);})();
